@model MyTender.Models.TenderViewModels.TenderViewModel

@{
    ViewData["Title"] = "Tender";
    ViewData["TenderId"] = Model.Tender.Id;
    Layout = "~/Views/Shared/_Layout.cshtml";
    bool IsMyTender = Model.Me.Id == Model.Tender.Author.Id;
}

<h2>@Model.Tender.Text</h2>
<h3>Reward = @Model.Tender.Price</h3>
@if (User.IsInRole("admin"))
{
    <h5><a asp-action="DeleteTender" asp-route-id="@Model.Tender.Id">DELETE</a></h5>
}

@{
    foreach (var r in Model.Responces.OrderByDescending(x=>x.likes))
    {
        string col = r.IsWinner?"gold":"ghostwhite";
        
        <div class="well" style="background-color:@col">
            
            @{
                if (r.IsWinner)
                {
                    <h1 style="color:red">WINNER</h1>
                    Html.RenderPartial("../Profiles/ProfilePArtial.cshtml", r.Author);
                }                
            }
            
            @if (IsMyTender && Model.Tender.IsActive)
            {
                <p><a asp-action="Close" asp-route-id="@r.Id">Make winner</a></p>
            }
            <p>@r.Text</p>             
            <p>
                @r.likes |
                @if (r.likedByMe)
                {
                    <a style="color:green;" asp-action="ToggleLike" asp-route-id="@r.Id"><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span></a>
                }
                else
                {
                    <a  asp-action="ToggleLike" asp-route-id="@r.Id"><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span></a>
                }
            </p>
            @if (User.IsInRole("admin"))
            {
                <h5><a asp-action="DeleteTenderResponce" asp-route-id="@r.Id">DELETE</a></h5>
            }
        </div>
         
    }
}

@if (Model.Tender.IsActive)
{
    @Html.Partial("AddResponce.cshtml", new TenderResponce(), ViewData)
}
else
{
    <h1 style="color:red">CLOSED</h1>
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

